#!/usr/bin/env bash

SOCKET="unix:/tmp/"$(lsof -U | grep -Eo "kitty-controller-[\d 0-9]*") 
DARK_WITH_CONTRAST=gruvbox_dark_hard
LIGHT_WITH_CONTRAST=gruvbox_light

DARK=$(echo $DARK_WITH_CONTRAST | sed 's/_soft//g' | sed 's/_hard//g')
LIGHT=$(echo $LIGHT_WITH_CONTRAST | sed 's/_soft//g' | sed 's/_hard//g')

if [[ $@ = "--dark" ]] 
then
    ln -sf ~/.config/sway/themes/catppuccin-$DARK ~/.config/sway/themes/active-theme \
      && ln -sf ~/.config/waybar/themes/$DARK.css ~/.config/waybar/themes/active.css \
      && swaymsg reload
    ln -sf ~/.config/dunst/dunstrc-$DARK ~/.config/dunst/dunstrc && pkill dunst
    ln -sf ~/.config/tofi/themes/catppuccin-$DARK ~/.config/tofi/themes/active
    
    sed -i 's/prefer-light/prefer-dark/g' ~/.local/share/nwg-look/gsettings && nwg-look -a && nwg-look -x
    kitty @ --to $SOCKET set-colors --all --configured "~/.config/kitty/themes/$DARK_WITH_CONTRAST.conf"
    echo 'dark' > $HOME/.config/theme.yaml
elif [[ $@ = "--light" ]] 
then
    ln -sf ~/.config/sway/themes/catppuccin-$LIGHT ~/.config/sway/themes/active-theme \
      && ln -sf ~/.config/waybar/themes/$LIGHT.css ~/.config/waybar/themes/active.css \
      && swaymsg reload
    ln -sf ~/.config/dunst/dunstrc-$LIGHT ~/.config/dunst/dunstrc && pkill dunst
    ln -sf ~/.config/tofi/themes/catppuccin-$LIGHT ~/.config/tofi/themes/active
    
    sed -i 's/prefer-dark/prefer-light/g' ~/.local/share/nwg-look/gsettings && nwg-look -a && nwg-look -x
    kitty @ --to $SOCKET set-colors --all --configured "~/.config/kitty/themes/$LIGHT_WITH_CONTRAST.conf"
    echo 'light' > $HOME/.config/theme.yaml
fi 
