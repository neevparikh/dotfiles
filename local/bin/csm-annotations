#! /usr/bin/env python3

import os
import sys
from subprocess import Popen
from i3ipc import Connection
import time

i3 = Connection()
name = i3.get_tree().find_focused().name

if "Shotwell" in name:
    filename, path = name.split(' ')[:2]
    path = os.path.expanduser(path.replace('(', '').replace(')', ''))
    filepath = os.path.join(path, filename)
    good_folder = os.path.join(path, 'good')
    bad_folder = os.path.join(path, 'bad')
    os.makedirs(good_folder, exist_ok=True)
    os.makedirs(bad_folder, exist_ok=True)
    try:
        location = sys.argv[1]
        if location == "good":
            os.rename(filepath, os.path.join(good_folder, filename))
        elif location == "bad":
            os.rename(filepath, os.path.join(bad_folder, filename))
        else:
            raise ValueError(location + " not understood")
        time.sleep(0.15)
        os.system(
            "xdotool key Right && xdotool key ctrl+plus ctrl+plus"  #  ctrl+plus ctrl+plus ctrl+plus ctrl+plus ctrl+plus ctrl+plus"
        )
    except Exception as e:
        os.system(f"notify-send '{e}'")
else:
    os.system(f"notify-send 'Error: Not in image viewer'")
